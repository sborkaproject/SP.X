/*!
 * SP.X tiny framework
 *
 * Copyright 2015 Sborka Project
 * Code by Hauts: http://hauts.ru/
 *
 * https://github.com/SborkaProject/SP.X 
 */
!function(factory){"use strict";function X(e,n,t){return X.create(e,n,t)}var SP=factory.SP=factory.SP||new function(){};if(!SP.X||!SP.X.create){var VERSION="1.006 [02.12.2015]",DUMMY=function(){},DEFAULT_NAME_PREFIX="SiteController_",USE_EVAL=!0,DEFINED="defined",RESOLVED="resolved",DOM_READY="domReady",WINDOW_LOADED="windowLoaded",ON="on",OFF="off",USE_LOG=!0,LOG_TESTED=!1,LOG_PREFIX="	SP.X: ",LOG_STYLE_PREFIX="%c",LOG_TEXT_STYLE="font-size:11px;font-style:italic;",LOG_STYLES={LOG:"color:#999999;"+LOG_TEXT_STYLE,ERROR:"color:#FF0000;"+LOG_TEXT_STYLE,WARN:"color:#FF7700;"+LOG_TEXT_STYLE,MARK:"color:#009900;"+LOG_TEXT_STYLE},LOG_CAN_USE_STYLING=!("undefined"==typeof window||!window.chrome),internals={nameCounter:0,getName:function(){return DEFAULT_NAME_PREFIX+ ++internals.nameCounter},instances:[],cachedExtensions:[],registerInstance:function(e){internals.instances.push(e),internals.updateInstances()},addExtension:function(e,n){internals.cachedExtensions.push({instances:[],method:e,applyArguments:n}),internals.updateInstances()},updateInstances:function(){for(var e=internals.cachedExtensions.length,n=internals.instances.length,t=0;e>t;t++)for(var r=internals.cachedExtensions[t],o=0;n>o;o++){var i=internals.instances[o];internals.testAddInstanceExtenstion(i,r)}},testAddInstanceExtenstion:function(e,n){for(var t=n.instances.length,r=0;t>r;r++)if(e===n.instances[r])return;n.instances.push(e);var o=e[n.method];o.apply(e,n.applyArguments)},sayHello:function(){if(USE_LOG)try{if(LOG_CAN_USE_STYLING){var e=["☭","★","✪","✫","✌","♚","♛","✍","☢"],n=e[Math.floor(Math.random()*e.length)],t=function(e,n){return"font-size:"+e+"px;color:"+n+";"};window.console.log("%c"+n,t(48,"#DC143C")),window.console.log("%cSborka Project",t(39,"#DC143C")),window.console.log("%cSP.X tiny framework v"+VERSION+"\n\n",t(14,"#11161F"))}else window.console.log("Sborka Project"),window.console.log("SP.X tiny framework v"+VERSION+"\n\n");LOG_TESTED=!0}catch(r){USE_LOG=!1}},toUnderscore:function(e){return e.replace(/([A-Z])/g,function(e){return"_"+e.toLowerCase()})},bindDOMReady:function(e){return document.addEventListener?document.addEventListener("DOMContentLoaded",e,!1):document.attachEvent?document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&e()}):internals.bindWindowLoad(e),internals},bindWindowLoad:function(e){var n=window.onload;return"function"==typeof window.onload?window.onload=function(){n&&n(),e()}:window.onload=e,internals},createNamedObject:function(name,props){var result=USE_EVAL?eval("new function "+name+"(){}"):{};for(var i in props)result[i]=props[i];return result}};X.Utils=internals.createNamedObject("Utils",{trim:function(e){return e.replace(/^\s+|\s+$/g,"")},isSet:function(e){return"undefined"!=typeof e&&null!=e},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},isArrayLike:function(e){return X.Utils.isArray(e)?!0:X.Utils.isObject(e)&&X.Utils.isNumber(e.length)?!0:!1},isNumber:function(e){return"number"==typeof e&&!isNaN(e)},isFunction:function(e){return"function"==typeof e},isObject:function(e){return"object"==typeof e},isString:function(e){return"string"==typeof e},createNamedObject:function(e,n){return internals.createNamedObject(e,n)},testCallback:function(e,n,t){return X.Utils.isFunction(e)?e.apply(t,n||[]):null},copy:function(e,n){for(var t in e)n[t]=e[t];return n},delegate:function(e,n){return function(){for(var t=arguments.length,r=new Array(t),o=0;t>o;o++)r[o]=arguments[o];return n.apply(e,r)}},now:function(){var e="performance";return window[e]&&window[e].now?X.Utils.now=function(){return window.performance.now()}:X.Utils.now=function(){return+new Date},X.Utils.now()},extractArrayValues:function(e){if(X.Utils.isArrayLike(e))return e;var n="\\";e=e.replace("  "," ");var t=e.split(" ").join(n);t=t.split(",").join(n),t=t.split(n);for(var r=[],o=t.length,i=0;o>i;i++){var a=t[i];a&&""!=a&&r.push(a)}return t=null,r}}),X.LogEngine=internals.createNamedObject("LogEngine"),X.LogEngine.create=function(e,n,t){function r(e,t){LOG_CAN_USE_STYLING?window.console.log(LOG_STYLE_PREFIX+LOG_PREFIX+n+e,t):window.console.log(n+e)}function o(n,o){if(t.debug&&USE_LOG)if(o=i.isSet(o)?o:LOG_STYLES.LOG,LOG_TESTED)r(n,o);else try{r(n,o),LOG_TESTED=!0}catch(a){USE_LOG=!1}return e}n=n||"";var i=X.Utils;return e.log=function(e){return o(e,LOG_STYLES.LOG)},e.error=function(e){return o(e,LOG_STYLES.ERROR)},e.warn=function(e){return o(e,LOG_STYLES.WARN)},e.mark=function(e){return o(e,LOG_STYLES.MARK)},e},X.EventsEngine=internals.createNamedObject("EventsEngine"),X.EventsEngine.create=function(e,n){function t(e,n){e=o.extractArrayValues(e);for(var t=0,a=e.length;a>t;t++){var s=e[t];r("Disabling event listeners for event type '"+s+"'");var c=i[s];o.isSet(c)||(c=i[s]=[]),c.disabled=n}}var r=n&&e.log||DUMMY,o=(n&&e.error||DUMMY,n&&e.warn||DUMMY,n&&e.mark||DUMMY,X.Utils),i={};return e.events=o.createNamedObject("events"),e.enableEvents=function(n){return t(n,!0),e},e.disableEvents=function(n){return t(n,!1),e},e.addEventListener=e.on=e.bind=function(n,t,a){n=o.extractArrayValues(n);for(var s={handler:t,context:o.isSet(a)?a:e},c=0,u=n.length;u>c;c++){var l=n[c];r("Add event listener for event type '"+l+"'");var d=i[l];o.isSet(d)||(d=i[l]=[]),d.push(s)}return e},e.addOnceEventListener=e.onOnce=e.once=e.bindOnce=function(n,t,r){return e.on(n,function(o){t.apply(r,[o]),e.off(n,t)})},e.removeEventListener=e.off=e.unbind=function(n,t){eventTypes=o.extractArrayValues(eventTypes);for(var a=0,s=eventTypes.length;s>a;a++){var n=eventTypes[a];r("Remove event listener for event type '"+n+"'");var c=i[n];if(o.isSet(c))for(var u=0,l=c.length;l>u;u++){var d=c[u];o.isSet(d)&&d.handler===t&&c.splice(u,1)}}return e},e.dispatch=function(n,t){n=o.extractArrayValues(n);for(var a=0,s=n.length;s>a;a++){var c=n[a],u=o.copy(t,o.createNamedObject("Event"));u.type=c;var l=[u];r("Dispatch event type '"+c+"'");var d=i[c];if(o.isSet(d))for(var f=0,v=d.length;v>f;f++){var E=d[f];o.isSet(E)&&o.testCallback(E.handler,l,E.context)}}return e},e.events.register=function(n,t){n=o.extractArrayValues(n);var i=n.length,a=i>1?"s":"";r("Register event constant"+a+" for type"+a+" '"+n.join("', '")+"'");for(var s=0;i>s;s++){var c=n[s],u=internals.toUnderscore(c).toUpperCase();if(e.events[u]=c,t){var l=c.substr(0,1).toUpperCase()+c.substr(1);e.events[ON+l]=function(n,t){return e.on(c,n,t)},e.events[OFF+l]=function(n){return e.off(c,n)}}}return e},e},X.DefineResolveEngine=internals.createNamedObject("DefineResolveEngine"),X.DefineResolveEngine.create=function(e,n){function t(){f=[];for(var e=v.length,n=E.length,t=0;e>t;t++){var r=v[t];if(r&&!r.resolved){for(var o=[],i=r.dependencies,a=i.length,u=0,d=[],p=0;a>p;p++){for(var g=i[p],h=!1,O=0;n>O;O++){var L=E[O];L.defined&&L.objectPath==g&&(u++,d.push(L.result),h=!0)}h||o.push(g)}u==a?(r.resolved=!0,s("Launching resolve for '"+i.join("', '")+"'"),l.testCallback(r.handler,d,r.context),c(RESOLVED,{data:r.result}),v.splice(t,1),t-=1):f.push({emptyDependencies:o})}}}function r(){d=[];for(var n=E.length,o=0;n>o;o++){var u=E[o];if(!u.defined){for(var f=[],v=0,p=u.dependencies,g=p.length,n=E.length,h=[],O=0;g>O;O++){for(var L=p[O],S=!1,b=0;n>b;b++){var y=E[b],D=y.objectPath;y.defined&&D==L&&(v++,h.push(y.result),S=!0)}S||f.push(L)}if(v==g){u.defined=!0,s("Resolved definition for '"+u.objectPath+"'"),u.targetPath[u.objectName]&&i(u.objectPath+" already defined!");var m=l.testCallback(u.handler,h,e);l.isSet(m)||a("Define handler for "+u.objectPath+" does not return anything"),u.result=u.targetPath[u.objectName]=m,c(DEFINED,{data:u.result}),t(),r()}else d.push({objectPath:u.objectPath,emptyDependencies:f})}}}var o=n&&e.log||DUMMY,i=n&&e.error||DUMMY,a=n&&e.warn||DUMMY,s=n&&e.mark||DUMMY,c=e.dispatch||DUMMY,u=e.on||DUMMY,l=X.Utils,d=[],f=[],v=[],E=[],p="";return e.define=function(n,t,a){if(!l.isString(n))return i("No objectPath passed to define!");p=n;var s=n.split("."),c=s.pop();if(""==c)return i("define must have objectPath (objectName) argument!");if(l.isFunction(t)&&(a=t,t=[]),!l.isSet(a))return i("No handler to define "+n+"!");for(var u=s.length,d=e,f=0;u>f;f++){var v=s[f];""!=v&&(d[v]=d=d[v]||l.createNamedObject(v))}return o("Added definition for '"+n+"'"),E.push({defined:!1,objectPath:n,targetPath:d,objectName:c,dependencies:t,handler:a}),r(),e},e.defineOn=function(n,t,r,i){return o("Added definition on event type '"+n+"' for '"+t+"'"),u(n,function(n){e.define(t,r,i)}),e},e.resolve=function(n,r,i){if(l.isFunction(n)){if(i=r,r=n,!p)return void a("No dependencies for resolve");n=[p]}return l.isArray(n)||(n=[n]),v.push({resolved:!1,dependencies:n,handler:r,context:l.isSet(i)?i:e}),o("Added resolve handler to '"+n.join("', '")+"'"),t(),e},e.isDefined=function(e){l.isArray(e)||(e=[e]);for(var n=e.length,t=E.length,r=0,o=0;t>o;o++){var i=E[o];if(i.defined)for(var a=0;n>a;a++){var s=e[a];if(s==i.objectPath&&(r++,r==n))return!0}}return!1},e.debugDefines=function(){var e=d.length;if(e){a("Empty definitions:");for(var n=0;e>n;n++){var t=d[n];o(t.objectPath),o("#"+(n+1)+"	"+t.emptyDependencies.join(", "))}}else s("All definitions ok");var r=f.length;if(r){a("Empty resolves:");for(var n=0;r>n;n++){var i=f[n];o("#"+(n+1)+"	"+i.emptyDependencies.join(", "))}}else s("All resolves ok");return{emptyDefines:d,emptyResolves:f}},e},X.create=function(e,n,t){e=e||internals.getName(),t=!!t;var r=X.Utils,o={debug:!!n},i=r.createNamedObject(e,{debug:function(e){return r.isSet(e)&&(o.debug=!!e,this.mark("Set debug mode "+(o.debug?ON:OFF))),o.debug},toggleDebug:function(){return this.debug(!this.debug())}});if(X.LogEngine.create(i,"["+e+"] ",o),o.debug){internals.sayHello();var a="Creating instance '"+e+"': debug mode ";a+=(o.debug?ON:OFF)+" & ",a+=(t?"skip export":"adding")+" to global context",i.mark(a)}var s=!0,c=!0;return X.EventsEngine.create(i,s).events.register([RESOLVED,DEFINED,DOM_READY,WINDOW_LOADED],!0),X.DefineResolveEngine.create(i,c).define("utils",function(){return X.Utils}),internals.bindDOMReady(function(){i.log("New state: DOM_READY"),i.dispatch(DOM_READY)}).bindWindowLoad(function(){i.log("New state: WINDOW_LOADED"),i.dispatch(WINDOW_LOADED)}),t||(r.isSet(factory[e])?i.log(e+" already defined: skipping export to global scope"):(i.mark(e+" added to global scope"),factory[e]=i)),internals.registerInstance(i),i},X.extend=function(e,n,t){internals.addExtension("define",[e,n,t])},SP.X=X,SP.X.Version=VERSION}}(this);